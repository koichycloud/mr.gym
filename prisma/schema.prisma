generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Socio {
  id              String        @id @default(uuid())
  codigo          String        @unique
  nombres         String?
  apellidos       String?
  tipoDocumento   String        @default("DNI")
  numeroDocumento String        @unique
  fechaNacimiento DateTime
  sexo            String        @default("M") // M = Masculino, F = Femenino
  telefono        String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  suscripciones    Suscripcion[]
  historialCodigos CodigoHistorial[]
  medidas          MedidaFisica[]
  asistencias      Asistencia[]
  pagos            Pago[]
  fotoUrl          String?      // URL de la foto del socio

  @@index([nombres, apellidos]) // Optimize name search
  @@map("Socio")
}

model CodigoHistorial {
  id          String   @id @default(uuid())
  socioId     String
  codigo      String
  fechaCambio DateTime @default(now())
  socio       Socio    @relation(fields: [socioId], references: [id], onDelete: Cascade)
}

model Suscripcion {
  id          String   @id @default(uuid())
  socioId     String
  fechaInicio DateTime @default(now())
  meses       Int
  fechaFin    DateTime
  estado      String   @default("ACTIVA")
  codigo      String?  // Code snapshot at the time of subscription
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  socio       Socio    @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@index([fechaFin, estado]) // Optimize expiration queries
  @@index([socioId])        // Optimize lookups by socio
}

model MedidaFisica {
  id              String   @id @default(uuid())
  socioId         String
  fecha           DateTime @default(now())
  peso            Float?
  altura          Float?
  porcentajeGrasa Float?
  porcentajeMusculo Float?
  cuello          Float?
  hombros         Float?
  pecho           Float?
  cintura         Float?
  vientreBajo     Float?
  cadera          Float?
  gluteos         Float?
  biceps          Float?
  antebrazos      Float?
  muslos          Float?
  cuadriceps      Float?
  pantorrillas    Float?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  socio           Socio    @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@index([socioId, fecha]) // Optimize chart data fetching
}

model Asistencia {
  id        String   @id @default(uuid())
  socioId   String
  fecha     DateTime @default(now())
  tipo      String   @default("ENTRADA") // ENTRADA o SALIDA
  socio     Socio    @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@index([socioId, fecha])
  @@index([fecha])
}

model Pago {
  id            String   @id @default(uuid())
  socioId       String?
  suscripcionId String?
  monto         Float
  metodoPago    String   @default("EFECTIVO") // EFECTIVO, TRANSFERENCIA, YAPE, PLIN
  concepto      String   @default("SUSCRIPCION") // SUSCRIPCION, PRODUCTO, OTRO
  descripcion   String?
  fecha         DateTime @default(now())
  createdAt     DateTime @default(now())
  socio         Socio?   @relation(fields: [socioId], references: [id], onDelete: SetNull)

  @@index([fecha])
  @@index([socioId])
}

